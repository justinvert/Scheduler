<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    
    <title>Scheduler</title>
</head>
<body>
    <style>.table-borderless td,
            .table-borderless th {
                border: 0;
               
            }



            </style>
        <div class="container">
                <div class="jumbotron">
                    <h1>Schedule Data</h1>
                    </div>

                    <div class="card">
                            <div class="card-header bg-primary mb-3 text-white">
                         <h5 class="card-title" style="margin-bottom:-3px;">Schedule Information</h5>
                            </div>
                        <div class="card-body">
                            
                        
                                    <table class="table table-borderless table-condensed table-hover">
                                        <thead>
                                    
                                            <th scope="col">Service Name</th>
                                            <th scope="col">Destination</th>
                                            <th scope="col">Frequency (Min)</th>
                                            <th scope="col">First Arrival</th>
                                            <th scope="col">Next Arrival</th>
                                            <th scope="col">Minutes Away</th>
                                            
                                        </thead>
                                     
                                                <!-- <tr>
                                                    <td id ="name-display"></td>
                                                    <td id ="destination-display"></td>
                                                    <td id="frequency-display"></td>
                                                    <td id="time-display"></td>
                                                    <td id="minsaway-display"></td> 
                                                </tr> -->
                                                <tbody id="rowNew">
                                                </tbody>
                                    </table>
                                </div>
                            </div>
                        </br>
             <div class="card">
                   <div class="card-header bg-primary mb-3 text-white">
                        <h5 class="card-title" style="margin-bottom:-3px;">Add Service</h5>
                         </div>
             <div class="card-body">
                    <form>
                <div class="form-group">
                    <label>Service Name</label>
    <input type="text" class="form-control" id="name"  placeholder="Amtrak">
</div>
              <div class="form-group">
                    <label>Destination</label>
    <input type="text" class="form-control" id="destination" placeholder="i.e. Philadelphia">
</div>
             <div class="form-group">
                    <label>First Service Time (HH:mm - Military Time)</label>
    <input type="text" class="form-control" id="time"  placeholder="12:10">
                                                        
</div>
            <div class="form-group">
                    <label>Frequency (min)</label>
    <input type="text" class="form-control" id="frequency"  placeholder="20">
</div>
                    
<button type="submit" class="btn-primary" id="submitbutton">Submit</button>
        </form>
         </div>
                                    </div>
                                </div>
                                </div>
                            </br>
    <script type="text/javascript">

 // Initialize Firebase
 var config = {
   
  };
  firebase.initializeApp(config);
  var dataRef = firebase.database();
  var timeUntil = moment();
  console.log(moment(timeUntil).format("hh:mm"));
  $("#submitbutton").on("click", function(e){
    event.preventDefault();

    var name = "";
    var destination = "";
    var time = "";
    var frequency = 0;


name = $("#name").val();
destination = $("#destination").val();
time = $("#time").val();
frequency = $("#frequency").val();



$("#name-display").text(name);
$("#destination-display").text(destination);
$("#time-display").text(time);
$("#frequency-display").text(frequency);


dataRef.ref().push({
    name: name,
    destination: destination,
   time: time,
    frequency: frequency,

});

});
dataRef.ref().on("child_added", function (childSnapshot){
    console.log(childSnapshot.val().name);
 
  var timeConvert = childSnapshot.val().time;
  var nameLabel = childSnapshot.val().name;
  var destinationLabel = childSnapshot.val().destination;
  var frequencyLabel = childSnapshot.val().frequency;

var convertedTime = moment(timeConvert, "HH:mm").subtract(1, "years");
// console.log(convertedTime);

// Frequency must be established
// Time must be documented (HH:mm)
// Covert time to minutes
// Divide minutes by the frequency
// Subtract frequency and divide amount

  var currentTime = moment();

  var diffTime = moment().diff(moment(convertedTime), "minutes");
  
  var tRemainder = diffTime % frequencyLabel;

  var tMinutesTillService = frequencyLabel- tRemainder;
  
  var nextArrival = moment().add(tMinutesTillService, "minutes");

         $("#rowNew").append("<tr>"+
     "<td>"+ nameLabel +" </td>" +
     "<td> " + destinationLabel + " </td>" 
     + "<td> " + frequencyLabel + " </td>"
      + "<td> " + timeConvert + "</td>"
      +" <td>"+ moment(nextArrival).format("HH:mm")+ "</td>"
      + "<td>" + tMinutesTillService +"</td>" +"</tr>");
});

    </script>
</html>